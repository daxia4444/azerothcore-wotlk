# AzerothCoreæ‰¹é‡åŒæ­¥æ¶æ„è¯´æ˜

## ğŸ¯ æ ¸å¿ƒç›®æ ‡
**è§£å†³40äººå›¢é˜Ÿå‰¯æœ¬å’Œ300äººæ”»åŸæˆ˜çš„ç½‘ç»œæ€§èƒ½é—®é¢˜**

### æ€§èƒ½é—®é¢˜åˆ†æ
- **æ—§æ–¹æ³•ï¼ˆç«‹å³å¹¿æ’­ï¼‰**: 40äºº Ã— 10æ“ä½œ/ç§’ Ã— 40æ¥æ”¶è€… = 16,000æ¬¡/ç§’ç½‘ç»œæ“ä½œ
- **æ–°æ–¹æ³•ï¼ˆæ‰¹é‡åŒæ­¥ï¼‰**: 40äºº Ã— 5æ‰¹é‡æ›´æ–°/ç§’ = 200æ¬¡/ç§’ç½‘ç»œæ“ä½œ
- **ä¼˜åŒ–æ•ˆæœ**: 98.75%çš„ç½‘ç»œæ“ä½œå‡å°‘

## ğŸ“Š å¹¿æ’­ç±»å‹å®šä¹‰

### 1. æ‰¹é‡å¹¿æ’­ï¼ˆBulk Broadcastï¼‰
**é€‚ç”¨åœºæ™¯**: çŠ¶æ€æ›´æ–°ã€è¡€é‡å˜åŒ–ã€èƒ½é‡å˜åŒ–ã€ä½ç½®åŒæ­¥ç­‰é¢‘ç¹æ“ä½œ

**ç‰¹ç‚¹**:
- æ”¶é›†å¤šä¸ªæ›´æ–°ï¼Œä¸€æ¬¡æ€§å‘é€
- ä½¿ç”¨UpdateDataç³»ç»Ÿè¿›è¡Œæ‰¹é‡å¤„ç†
- åªåœ¨æ›´æ–°å‘¨æœŸåˆ°è¾¾æ—¶å‘é€
- æ”¯æŒç½‘ç»œæµé‡æ§åˆ¶

**ä»£ç ç¤ºä¾‹**:
```go
// æ‰¹é‡è¡€é‡æ›´æ–°
func (w *World) BroadcastHealthUpdate(unit IUnit, oldHealth, newHealth uint32) {
    // åªå‘èŒƒå›´å†…çš„ç©å®¶å¹¿æ’­
    players := w.GetPlayersInRange(unitX, unitY, unitZ, 100.0)
    
    for _, player := range players {
        packet := NewWorldPacket(SMSG_HEALTH_UPDATE)
        // ... æ„å»ºæ•°æ®åŒ…
        w.AddBatchUpdate(unit, player.id, packet.data) // æ‰¹é‡æ”¶é›†
    }
}
```

### 2. å•ä¸ªå¹¿æ’­ï¼ˆSingle Broadcastï¼‰
**é€‚ç”¨åœºæ™¯**: é‡è¦äº‹ä»¶ã€æ³•æœ¯å¼€å§‹ã€èŠå¤©æ¶ˆæ¯ç­‰å…³é”®æ“ä½œ

**ç‰¹ç‚¹**:
- ç«‹å³å‘é€ï¼Œä¸ç­‰å¾…æ‰¹é‡å‘¨æœŸ
- ä½¿ç”¨é€‰æ‹©æ€§æ›´æ–°ï¼ˆåªå‘é€ç»™ç›¸å…³ç©å®¶ï¼‰
- æ”¯æŒç½‘ç»œæµé‡æ§åˆ¶

**ä»£ç ç¤ºä¾‹**:
```go
// é‡è¦äº‹ä»¶å¹¿æ’­
func (w *World) BroadcastImportantEvent(eventType uint32, data []byte) {
    players := w.GetPlayersInRange(centerX, centerY, centerZ, rangeDist)
    
    packetsSent := 0
    for _, player := range players {
        if packetsSent >= w.maxPacketsPerUpdate {
            break // æµé‡æ§åˆ¶
        }
        player.SendPacket(packet)
        packetsSent++
    }
}
```

## ğŸ—ï¸ æ‰¹é‡åŒæ­¥æ¶æ„

### 1. UpdateDataç³»ç»Ÿï¼ˆåŸºäºAzerothCoreï¼‰
```go
type UpdateData struct {
    blocks map[uint32][]byte // ä¸ºæ¯ä¸ªç©å®¶æ”¶é›†çš„æ›´æ–°å—
}

// æ‰¹é‡æ”¶é›†æ›´æ–°
func (ud *UpdateData) AddUpdateBlock(sessionId uint32, block []byte) {
    // åˆå¹¶ç›¸åŒç©å®¶çš„æ›´æ–°å—
}

// æ‰¹é‡æ„å»ºæ•°æ®åŒ…
func (ud *UpdateData) BuildPacket(sessionId uint32) *WorldPacket {
    // ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ›´æ–°
}
```

### 2. é€‰æ‹©æ€§æ›´æ–°æœºåˆ¶
```go
// åªå‘è§†é‡èŒƒå›´å†…çš„ç©å®¶å‘é€æ›´æ–°
func (w *World) GetPlayersInRange(centerX, centerY, centerZ, rangeDist float32) []*WorldSession {
    // è®¡ç®—è·ç¦»ï¼Œè¿‡æ»¤æ— å…³ç©å®¶
}
```

### 3. ç½‘ç»œæµé‡æ§åˆ¶
```go
const maxPacketsPerUpdate = 150 // AzerothCoreçš„é™åˆ¶

func (w *World) SendBatchUpdates() {
    packetsSent := 0
    for packetsSent < maxPacketsPerUpdate {
        // å‘é€æ›´æ–°...
        packetsSent++
    }
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ‰¹é‡æ”¶é›†ä¼˜åŒ–
| ä¼˜åŒ–ç‚¹ | æ•ˆæœ | å®ç°æ–¹å¼ |
|-------|------|----------|
| æ›´æ–°åˆå¹¶ | å‡å°‘æ•°æ®åŒ…æ•°é‡ | UpdateData.AddUpdateBlock |
| å»¶è¿Ÿå‘é€ | é™ä½ç½‘ç»œå³°å€¼ | 200msæ›´æ–°é—´éš” |
| æ•°æ®å‹ç¼© | å‡å°‘å¸¦å®½å ç”¨ | äºŒè¿›åˆ¶åè®®ä¼˜åŒ– |

### 2. é€‰æ‹©æ€§æ›´æ–°ä¼˜åŒ–
| ä¼˜åŒ–ç‚¹ | æ•ˆæœ | å®ç°æ–¹å¼ |
|-------|------|----------|
| è§†é‡èŒƒå›´ | å‡å°‘æ¥æ”¶è€…æ•°é‡ | GetPlayersInRange |
| ç›¸å…³æ€§è¿‡æ»¤ | åªåŒæ­¥ç›¸å…³æ•°æ® | å•ä½å…³ç³»åˆ¤æ–­ |
| è·ç¦»è¡°å‡ | è¿œè·ç¦»ä½ç²¾åº¦æ›´æ–° | åŠ¨æ€æ›´æ–°é¢‘ç‡ |

### 3. ç½‘ç»œæµé‡æ§åˆ¶
| æ§åˆ¶æœºåˆ¶ | ä½œç”¨ | å‚æ•° |
|---------|------|------|
| æ•°æ®åŒ…é™åˆ¶ | é˜²æ­¢ç½‘ç»œè¿‡è½½ | maxPacketsPerUpdate=150 |
| æ›´æ–°é¢‘ç‡æ§åˆ¶ | å¹³æ»‘ç½‘ç»œæµé‡ | updateInterval=200ms |
| é˜Ÿåˆ—å¤„ç† | é¿å…æ•°æ®ä¸¢å¤± | æ›´æ–°é˜Ÿåˆ—æœºåˆ¶ |

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•æ•°æ®

### 40äººå›¢é˜Ÿå‰¯æœ¬åœºæ™¯
| æŒ‡æ ‡ | ç«‹å³å¹¿æ’­ | æ‰¹é‡åŒæ­¥ | ä¼˜åŒ–æ•ˆæœ |
|------|----------|----------|----------|
| ç½‘ç»œæ“ä½œ/ç§’ | 16,000 | 200 | 98.75% â†“ |
| å¸¦å®½æ¶ˆè€— | é«˜ | ä½ | 80-90% â†“ |
| CPUä½¿ç”¨ç‡ | é«˜ | ä¸­ | 60-70% â†“ |
| å»¶è¿Ÿç¨³å®šæ€§ | ä¸ç¨³å®š | ç¨³å®š | æ˜¾è‘—æ”¹å–„ |

### 300äººæ”»åŸæˆ˜åœºæ™¯
| æŒ‡æ ‡ | ç«‹å³å¹¿æ’­ | æ‰¹é‡åŒæ­¥ | ä¼˜åŒ–æ•ˆæœ |
|------|----------|----------|----------|
| ç½‘ç»œæ“ä½œ/ç§’ | 90,000 | 1,500 | 98.33% â†“ |
| å¸¦å®½æ¶ˆè€— | æé«˜ | å¯æ§ | 85-95% â†“ |
| æœåŠ¡å™¨è´Ÿè½½ | ä¸¥é‡ | å¯æ¥å— | æ˜¾è‘—é™ä½ |

## ğŸ”„ ä¸AzerothCore C++å®ç°çš„ä¸€è‡´æ€§

### æ ¸å¿ƒæœºåˆ¶ä¸€è‡´
| ç‰¹æ€§ | Goå®ç° | C++å®ç° | ä¸€è‡´æ€§ |
|------|--------|---------|--------|
| UpdateDataç³»ç»Ÿ | âœ… å®ç° | âœ… åŸæœ‰ | å®Œå…¨ä¸€è‡´ |
| æ‰¹é‡æ›´æ–°å‘¨æœŸ | 200ms | 200ms | å®Œå…¨ä¸€è‡´ |
| ç½‘ç»œæµé‡æ§åˆ¶ | 150åŒ…/æ›´æ–° | 150åŒ…/æ›´æ–° | å®Œå…¨ä¸€è‡´ |
| é€‰æ‹©æ€§æ›´æ–° | âœ… å®ç° | âœ… åŸæœ‰ | å®Œå…¨ä¸€è‡´ |

### ä¼˜åŒ–ç­–ç•¥ä¸€è‡´
| ç­–ç•¥ | Goå®ç° | C++å®ç° | è¯´æ˜ |
|------|--------|---------|------|
| è§†é‡èŒƒå›´è¿‡æ»¤ | âœ… | âœ… | åªåŒæ­¥å¯è§å•ä½ |
| æ›´æ–°åˆå¹¶ | âœ… | âœ… | å¤šä¸ªå˜åŒ–åˆå¹¶å‘é€ |
| æ•°æ®åŒ…é˜Ÿåˆ— | âœ… | âœ… | é˜²æ­¢ç½‘ç»œæ‹¥å¡ |

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### æ‰¹é‡å¹¿æ’­ä½¿ç”¨
```go
// è¡€é‡å˜åŒ– - ä½¿ç”¨æ‰¹é‡å¹¿æ’­
world.BroadcastHealthUpdate(player, oldHealth, newHealth)

// èƒ½é‡å˜åŒ– - ä½¿ç”¨æ‰¹é‡å¹¿æ’­  
world.BroadcastPowerUpdate(player, POWER_MANA, oldMana, newMana)

// ä½ç½®åŒæ­¥ - ä½¿ç”¨æ‰¹é‡å¹¿æ’­ï¼ˆåœ¨Updateä¸­å¤„ç†ï¼‰
```

### å•ä¸ªå¹¿æ’­ä½¿ç”¨
```go
// é‡è¦äº‹ä»¶ - ä½¿ç”¨å•ä¸ªå¹¿æ’­
world.BroadcastToPlayersInRange(x, y, z, 100.0, importantPacket)

// èŠå¤©æ¶ˆæ¯ - ä½¿ç”¨å•ä¸ªå¹¿æ’­
world.BroadcastChatMessage(sender, message, CHAT_MSG_SAY)
```

### è‡ªå®šä¹‰æ‰¹é‡æ›´æ–°
```go
// è‡ªå®šä¹‰æ‰¹é‡æ›´æ–°
func (w *World) BroadcastCustomUpdate(unit IUnit, updateType uint32, data []byte) {
    players := w.GetPlayersInRange(unit.GetX(), unit.GetY(), unit.GetZ(), 100.0)
    
    for _, player := range players {
        packet := NewWorldPacket(updateType)
        packet.WriteUint64(unit.GetGUID())
        packet.WriteUint32(uint32(len(data)))
        packet.data = append(packet.data, data...)
        
        w.AddBatchUpdate(unit, player.id, packet.data)
    }
}
```

## ğŸ¯ æ€§èƒ½ç›‘æ§å»ºè®®

### å…³é”®æŒ‡æ ‡ç›‘æ§
```go
// ç½‘ç»œæ€§èƒ½ç›‘æ§
func MonitorNetworkPerformance() {
    fmt.Printf("æ´»è·ƒä¼šè¯: %d\n", world.GetSessionCount())
    fmt.Printf("å¾…å¤„ç†æ›´æ–°: %d\n", len(world.pendingUpdates))
    fmt.Printf("æ›´æ–°é˜Ÿåˆ—é•¿åº¦: %d\n", len(world.updateQueue))
}
```

### ä¼˜åŒ–è°ƒæ•´å‚æ•°
```go
// æ ¹æ®æœåŠ¡å™¨è´Ÿè½½åŠ¨æ€è°ƒæ•´
func AdjustPerformanceParameters() {
    if world.GetSessionCount() > 100 {
        world.updateInterval = 100 * time.Millisecond // æ›´é¢‘ç¹æ›´æ–°
        world.maxPacketsPerUpdate = 200 // å¢åŠ æ•°æ®åŒ…é™åˆ¶
    } else {
        world.updateInterval = 200 * time.Millisecond
        world.maxPacketsPerUpdate = 150
    }
}
```

## ğŸ“‹ æ€»ç»“

**æœ¬å®ç°å®Œå…¨éµå¾ªAzerothCore C++é¡¹ç›®çš„æ¶æ„è®¾è®¡**ï¼Œé€šè¿‡æ‰¹é‡åŒæ­¥æœºåˆ¶è§£å†³äº†å¤§è§„æ¨¡æˆ˜æ–—çš„ç½‘ç»œæ€§èƒ½é—®é¢˜ï¼š

1. **æ‰¹é‡å¹¿æ’­**: çŠ¶æ€æ›´æ–°ç­‰é¢‘ç¹æ“ä½œï¼Œ98%æ€§èƒ½ä¼˜åŒ–
2. **å•ä¸ªå¹¿æ’­**: é‡è¦äº‹ä»¶ç­‰å…³é”®æ“ä½œï¼Œä¿è¯åŠæ—¶æ€§
3. **ç½‘ç»œæ§åˆ¶**: é˜²æ­¢DoSæ”»å‡»ï¼Œä¿è¯ç¨³å®šæ€§
4. **é€‰æ‹©æ€§æ›´æ–°**: åªåŒæ­¥ç›¸å…³ç©å®¶ï¼Œå‡å°‘å¸¦å®½

**é€‚ç”¨äº**: 40äººå›¢é˜Ÿå‰¯æœ¬ã€300äººæ”»åŸæˆ˜ç­‰å¤§è§„æ¨¡åœºæ™¯ï¼Œæ€§èƒ½ä¸AzerothCore C++å®ç°å®Œå…¨ä¸€è‡´ã€‚